<div class="travel-container">
  <h1>Plan Your Journey</h1>

  <form [formGroup]="travelForm" (ngSubmit)="onSubmit()">
    <div class="form-row">
      <div class="form-group">
        <label for="from">From:</label>
        <div class="input-group">
          <input
            type="text"
            id="from"
            formControlName="from"
            placeholder="Enter origin (latitude,longitude)"
          />
          <button
            type="button"
            class="location-btn"
            (click)="getCurrentLocation()"
            title="Use Current Location"
          >
            üìç
          </button>
        </div>
        <div
          class="error"
          *ngIf="
            travelForm.get('from')?.invalid && travelForm.get('from')?.touched
          "
        >
          Origin location is required
        </div>
      </div>

      <div class="form-group">
        <label for="to">To:</label>
        <div class="input-locations">
          <app-location-button
            title="Informatik"
            location="Rotkreuz"
            (btnClicked)="
              onLocationButtonClick('47.14352282294816, 8.432576926508915')
            "
          ></app-location-button>
          <app-location-button
            title="Design,Film und Kunst"
            location="Emmenbr√ºcke"
            (btnClicked)="
              onLocationButtonClick('47.07173422069437, 8.277630465694969')
            "
          ></app-location-button>
          <app-location-button
            title="Soziale Arbeit"
            location="Luzern"
            (btnClicked)="
              onLocationButtonClick('47.04824253253547, 8.314788883279503')
            "
          ></app-location-button>
          <app-location-button
            title="Wirtschaft"
            location="Luzern"
            (btnClicked)="
              onLocationButtonClick('47.049212803608405, 8.309684542699761')
            "
          ></app-location-button>
          <app-location-button
            title="Musik"
            location="Kriens"
            (btnClicked)="
              onLocationButtonClick('47.032920164342464, 8.297112187930741')
            "
          ></app-location-button>
          <app-location-button
            title="Technik und Architektur"
            location="Horw"
            (btnClicked)="
              onLocationButtonClick('47.01459985298802, 8.305195454112935')
            "
          ></app-location-button>
        </div>
        <input
          type="text"
          id="to"
          formControlName="to"
          placeholder="Enter destination (latitude,longitude)"
        />
        <div
          class="error"
          *ngIf="travelForm.get('to')?.invalid && travelForm.get('to')?.touched"
        >
          Destination is required
        </div>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="mode">Travel Mode:</label>
        <select id="mode" formControlName="mode">
          <option value="train">Train</option>
          <option value="car">Car</option>
        </select>
      </div>

      <div class="form-group">
        <label for="date">Date:</label>
        <input type="date" id="date" formControlName="date" />
      </div>

      <div class="form-group">
        <label for="time">Time:</label>
        <input type="time" id="time" formControlName="time" />
      </div>
    </div>

    <button type="submit" [disabled]="travelForm.invalid || loading">
      {{ loading ? 'Searching...' : 'Find Routes' }}
    </button>
  </form>

  <button (click)="saveJourney()">Save Journey</button>
  {{ journey$ | async }}

  <app-mapbox [locations]="mapLocations" [geometry]="mapGeometry"></app-mapbox>

  <div class="results" *ngIf="travelResults">
    <h2>Travel Options</h2>

    <div *ngIf="(travelResults?.trainConnections?.length ?? 0) > 0">
      <h3>Zugverbindungen</h3>
      <app-train-connection
        *ngFor="let connection of travelResults.trainConnections; let i = index"
        [connection]="connection"
        [index]="i"
      >
      </app-train-connection>
    </div>

    <div class="car-route" *ngIf="travelResults.carRoute">
      <h3>Car Route</h3>
      <div>
        <strong>Distance:</strong> {{ travelResults.carRoute.distance }}
      </div>
      <div>
        <strong>Duration:</strong> {{ travelResults.carRoute.duration }}
      </div>
      <div
        class="route-steps"
        *ngIf="
          travelResults.carRoute.steps && travelResults.carRoute.steps.length
        "
      >
        <strong>Directions:</strong>
        <ol>
          <li *ngFor="let step of travelResults.carRoute.steps">{{ step }}</li>
        </ol>
      </div>
    </div>
  </div>

  <div class="error-message" *ngIf="error">
    {{ error }}
  </div>
</div>
